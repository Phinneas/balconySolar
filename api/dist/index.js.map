{
  "version": 3,
  "sources": ["../src/cache.js", "../src/analytics.js", "../src/errors.js", "../src/index.js"],
  "sourceRoot": "dist",
  "sourcesContent": ["/**\n * Cache management for Balcony Solar Checker API\n * Handles in-memory caching with TTL and invalidation\n */\n\nclass CacheManager {\n  constructor(ttlMs = 24 * 60 * 60 * 1000) {\n    this.store = new Map();\n    this.ttl = ttlMs;\n  }\n\n  /**\n   * Get a value from cache\n   * @param {string} key - Cache key\n   * @returns {any|null} - Cached value or null if expired/missing\n   */\n  get(key) {\n    const entry = this.store.get(key);\n    \n    if (!entry) {\n      return null;\n    }\n\n    // Check if expired\n    if (Date.now() - entry.timestamp > this.ttl) {\n      this.store.delete(key);\n      return null;\n    }\n\n    return entry.value;\n  }\n\n  /**\n   * Set a value in cache\n   * @param {string} key - Cache key\n   * @param {any} value - Value to cache\n   */\n  set(key, value) {\n    this.store.set(key, {\n      value,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Check if key exists and is not expired\n   * @param {string} key - Cache key\n   * @returns {boolean}\n   */\n  has(key) {\n    return this.get(key) !== null;\n  }\n\n  /**\n   * Delete a specific key\n   * @param {string} key - Cache key\n   */\n  delete(key) {\n    this.store.delete(key);\n  }\n\n  /**\n   * Invalidate cache by pattern\n   * @param {string|null} pattern - Pattern to match keys (null = clear all)\n   */\n  invalidate(pattern = null) {\n    if (!pattern) {\n      this.store.clear();\n      return;\n    }\n\n    for (const key of this.store.keys()) {\n      if (key.includes(pattern)) {\n        this.store.delete(key);\n      }\n    }\n  }\n\n  /**\n   * Get cache statistics\n   * @returns {object} - Cache stats\n   */\n  getStats() {\n    let totalSize = 0;\n    let expiredCount = 0;\n\n    for (const [key, entry] of this.store.entries()) {\n      if (Date.now() - entry.timestamp > this.ttl) {\n        expiredCount++;\n      }\n      totalSize += JSON.stringify(entry.value).length;\n    }\n\n    return {\n      size: this.store.size,\n      expiredCount,\n      totalSizeBytes: totalSize,\n      ttlMs: this.ttl,\n    };\n  }\n\n  /**\n   * Clean up expired entries\n   */\n  cleanup() {\n    const now = Date.now();\n    let cleaned = 0;\n\n    for (const [key, entry] of this.store.entries()) {\n      if (now - entry.timestamp > this.ttl) {\n        this.store.delete(key);\n        cleaned++;\n      }\n    }\n\n    return cleaned;\n  }\n}\n\nexport default CacheManager;\n", "/**\n * Analytics Service for Backend\n * Processes and stores user engagement metrics and feedback\n */\n\nclass AnalyticsService {\n  constructor(options = {}) {\n    this.events = [];\n    this.feedback = [];\n    this.sessions = new Map();\n    this.maxEventsInMemory = options.maxEventsInMemory || 10000;\n    this.maxFeedbackInMemory = options.maxFeedbackInMemory || 1000;\n  }\n\n  /**\n   * Record analytics events\n   * @param {string} sessionId - Session ID\n   * @param {array} events - Array of events\n   */\n  recordEvents(sessionId, events) {\n    if (!Array.isArray(events)) {\n      throw new Error('Events must be an array');\n    }\n\n    // Track session\n    if (!this.sessions.has(sessionId)) {\n      this.sessions.set(sessionId, {\n        sessionId,\n        startTime: Date.now(),\n        eventCount: 0,\n        lastEventTime: Date.now(),\n      });\n    }\n\n    const session = this.sessions.get(sessionId);\n    session.eventCount += events.length;\n    session.lastEventTime = Date.now();\n\n    // Store events\n    this.events.push(...events);\n\n    // Maintain size limit\n    if (this.events.length > this.maxEventsInMemory) {\n      this.events = this.events.slice(-this.maxEventsInMemory);\n    }\n  }\n\n  /**\n   * Record user feedback\n   * @param {object} feedback - Feedback object\n   */\n  recordFeedback(feedback) {\n    const feedbackRecord = {\n      ...feedback,\n      recordedAt: Date.now(),\n    };\n\n    this.feedback.push(feedbackRecord);\n\n    // Maintain size limit\n    if (this.feedback.length > this.maxFeedbackInMemory) {\n      this.feedback = this.feedback.slice(-this.maxFeedbackInMemory);\n    }\n  }\n\n  /**\n   * Get analytics summary\n   * @param {number} windowMs - Time window in milliseconds (default: 24 hours)\n   * @returns {object} Analytics summary\n   */\n  getAnalyticsSummary(windowMs = 24 * 60 * 60 * 1000) {\n    const now = Date.now();\n    const recentEvents = this.events.filter(e => now - e.timestamp < windowMs);\n    const recentFeedback = this.feedback.filter(f => now - f.recordedAt < windowMs);\n\n    // Count event types\n    const eventTypeCounts = {};\n    recentEvents.forEach(event => {\n      eventTypeCounts[event.type] = (eventTypeCounts[event.type] || 0) + 1;\n    });\n\n    // Count feedback types\n    const feedbackTypeCounts = {};\n    recentFeedback.forEach(feedback => {\n      feedbackTypeCounts[feedback.type] = (feedbackTypeCounts[feedback.type] || 0) + 1;\n    });\n\n    // Get most viewed states\n    const stateViews = {};\n    recentEvents\n      .filter(e => e.type === 'view_state' && e.data.stateCode)\n      .forEach(event => {\n        stateViews[event.data.stateCode] = (stateViews[event.data.stateCode] || 0) + 1;\n      });\n\n    const topStates = Object.entries(stateViews)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 10)\n      .map(([code, count]) => ({ code, count }));\n\n    // Calculate average rating\n    const ratings = recentFeedback\n      .filter(f => f.type === 'rating' && f.rating)\n      .map(f => f.rating);\n    const averageRating = ratings.length > 0 ? ratings.reduce((a, b) => a + b) / ratings.length : null;\n\n    // Get active sessions\n    const activeSessions = Array.from(this.sessions.values()).filter(\n      s => now - s.lastEventTime < windowMs\n    );\n\n    return {\n      timeWindow: `${windowMs / (1000 * 60 * 60)} hours`,\n      totalEvents: recentEvents.length,\n      totalSessions: activeSessions.length,\n      totalFeedback: recentFeedback.length,\n      eventTypes: eventTypeCounts,\n      feedbackTypes: feedbackTypeCounts,\n      topStates,\n      averageRating: averageRating ? averageRating.toFixed(2) : null,\n      activeSessions: activeSessions.length,\n    };\n  }\n\n  /**\n   * Get engagement metrics\n   * @param {number} windowMs - Time window in milliseconds\n   * @returns {object} Engagement metrics\n   */\n  getEngagementMetrics(windowMs = 24 * 60 * 60 * 1000) {\n    const now = Date.now();\n    const recentEvents = this.events.filter(e => now - e.timestamp < windowMs);\n\n    // Count unique sessions\n    const uniqueSessions = new Set(recentEvents.map(e => e.sessionId)).size;\n\n    // Count interactions\n    const interactions = {\n      stateSelections: recentEvents.filter(e => e.type === 'select_state').length,\n      stateViews: recentEvents.filter(e => e.type === 'view_state').length,\n      linkCopies: recentEvents.filter(e => e.type === 'copy_link').length,\n      resourceClicks: recentEvents.filter(e => e.type === 'click_resource').length,\n      newsletterClicks: recentEvents.filter(e => e.type === 'click_newsletter_cta').length,\n      relatedContentClicks: recentEvents.filter(e => e.type === 'click_related_content').length,\n      errors: recentEvents.filter(e => e.type === 'error').length,\n    };\n\n    // Calculate conversion rates\n    const conversionRates = {\n      viewToShare: interactions.stateViews > 0 ? ((interactions.linkCopies / interactions.stateViews) * 100).toFixed(2) : 0,\n      viewToNewsletter: interactions.stateViews > 0 ? ((interactions.newsletterClicks / interactions.stateViews) * 100).toFixed(2) : 0,\n      viewToRelatedContent: interactions.stateViews > 0 ? ((interactions.relatedContentClicks / interactions.stateViews) * 100).toFixed(2) : 0,\n    };\n\n    return {\n      uniqueSessions,\n      totalInteractions: recentEvents.length,\n      interactions,\n      conversionRates,\n    };\n  }\n\n  /**\n   * Get feedback summary\n   * @param {number} windowMs - Time window in milliseconds\n   * @returns {object} Feedback summary\n   */\n  getFeedbackSummary(windowMs = 24 * 60 * 60 * 1000) {\n    const now = Date.now();\n    const recentFeedback = this.feedback.filter(f => now - f.recordedAt < windowMs);\n\n    const summary = {\n      totalFeedback: recentFeedback.length,\n      byType: {},\n      ratings: {\n        average: null,\n        distribution: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 },\n      },\n      suggestions: [],\n      bugReports: [],\n    };\n\n    recentFeedback.forEach(feedback => {\n      // Count by type\n      summary.byType[feedback.type] = (summary.byType[feedback.type] || 0) + 1;\n\n      // Process ratings\n      if (feedback.type === 'rating' && feedback.rating) {\n        summary.ratings.distribution[feedback.rating]++;\n      }\n\n      // Collect suggestions\n      if (feedback.type === 'suggestion' && feedback.message) {\n        summary.suggestions.push({\n          message: feedback.message,\n          stateCode: feedback.stateCode,\n          timestamp: feedback.timestamp,\n        });\n      }\n\n      // Collect bug reports\n      if (feedback.type === 'bug_report' && feedback.message) {\n        summary.bugReports.push({\n          message: feedback.message,\n          stateCode: feedback.stateCode,\n          email: feedback.email,\n          timestamp: feedback.timestamp,\n        });\n      }\n    });\n\n    // Calculate average rating\n    const ratings = recentFeedback\n      .filter(f => f.type === 'rating' && f.rating)\n      .map(f => f.rating);\n    if (ratings.length > 0) {\n      summary.ratings.average = (ratings.reduce((a, b) => a + b) / ratings.length).toFixed(2);\n    }\n\n    return summary;\n  }\n\n  /**\n   * Get recent events\n   * @param {number} limit - Number of recent events to return\n   * @returns {array} Recent events\n   */\n  getRecentEvents(limit = 100) {\n    return this.events.slice(-limit);\n  }\n\n  /**\n   * Get recent feedback\n   * @param {number} limit - Number of recent feedback to return\n   * @returns {array} Recent feedback\n   */\n  getRecentFeedback(limit = 50) {\n    return this.feedback.slice(-limit);\n  }\n\n  /**\n   * Get session info\n   * @param {string} sessionId - Session ID\n   * @returns {object|null} Session info or null\n   */\n  getSessionInfo(sessionId) {\n    return this.sessions.get(sessionId) || null;\n  }\n\n  /**\n   * Get all active sessions\n   * @param {number} windowMs - Time window for active sessions\n   * @returns {array} Active sessions\n   */\n  getActiveSessions(windowMs = 60 * 60 * 1000) {\n    const now = Date.now();\n    return Array.from(this.sessions.values()).filter(\n      s => now - s.lastEventTime < windowMs\n    );\n  }\n\n  /**\n   * Reset analytics data\n   */\n  reset() {\n    this.events = [];\n    this.feedback = [];\n    this.sessions.clear();\n  }\n}\n\nexport default AnalyticsService;\n", "/**\n * Error handling for Balcony Solar Checker API\n */\n\nexport class APIError extends Error {\n  constructor(message, statusCode = 500, code = 'INTERNAL_ERROR') {\n    super(message);\n    this.statusCode = statusCode;\n    this.code = code;\n    this.name = 'APIError';\n  }\n}\n\nexport class NotFoundError extends APIError {\n  constructor(message = 'Resource not found') {\n    super(message, 404, 'NOT_FOUND');\n    this.name = 'NotFoundError';\n  }\n}\n\nexport class BadRequestError extends APIError {\n  constructor(message = 'Bad request') {\n    super(message, 400, 'BAD_REQUEST');\n    this.name = 'BadRequestError';\n  }\n}\n\nexport class TimeoutError extends APIError {\n  constructor(message = 'Request timeout') {\n    super(message, 504, 'TIMEOUT');\n    this.name = 'TimeoutError';\n  }\n}\n\nexport class ExternalServiceError extends APIError {\n  constructor(message = 'External service error', statusCode = 502) {\n    super(message, statusCode, 'EXTERNAL_SERVICE_ERROR');\n    this.name = 'ExternalServiceError';\n  }\n}\n\nexport function formatErrorResponse(error) {\n  if (error instanceof APIError) {\n    return {\n      error: {\n        message: error.message,\n        code: error.code,\n        statusCode: error.statusCode,\n      },\n      statusCode: error.statusCode,\n    };\n  }\n\n  // Unknown error\n  return {\n    error: {\n      message: 'Internal server error',\n      code: 'INTERNAL_ERROR',\n      statusCode: 500,\n    },\n    statusCode: 500,\n  };\n}\n", "/**\n * Balcony Solar Checker REST API\n * Cloudflare Workers\n */\n\nimport CacheManager from './cache.js';\nimport AnalyticsService from './analytics.js';\nimport { \n  APIError, \n  NotFoundError, \n  TimeoutError, \n  ExternalServiceError,\n  formatErrorResponse \n} from './errors.js';\n\nconst TEABLE_API_URL = 'https://app.teable.ai/api';\nconst TEABLE_BASE_ID = 'bseTnc7nTi3FYus3yIk';\nconst TEABLE_API_TOKEN = 'teable_accQGmhU1fVBigSZL4a_gsnFqNXarx/RjkgVZXnieOhSeMkSmyugBV0N9Mekvfk=';\nconst CACHE_INVALIDATE_TOKEN = 'cache_invalidate_token_secret_key_12345';\n\nconst TABLE_IDS = {\n  states: 'tbl9JsNibYgkgi7iEVW',\n  details: 'tbl2QU2ySxGNHLhNstq',\n  resources: 'tblGYUmWEMeTg4oBTY3',\n  updateLog: 'tblNAUNfKxO4Wi0SJ1A',\n};\n\n// Cache manager with 24-hour TTL\nconst cache = new CacheManager(24 * 60 * 60 * 1000);\nconst CACHE_TTL_SECONDS = 24 * 60 * 60;\n\n// Analytics service\nconst analytics = new AnalyticsService({\n  maxEventsInMemory: 10000,\n  maxFeedbackInMemory: 1000,\n});\n\nasync function fetchFromTeable(tableId, query = '') {\n  const url = `${TEABLE_API_URL}/table/${tableId}/record${query}`;\n  \n  try {\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout\n\n    const response = await fetch(url, {\n      headers: {\n        'Authorization': `Bearer ${TEABLE_API_TOKEN}`,\n        'Content-Type': 'application/json',\n      },\n      signal: controller.signal,\n    });\n\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        throw new NotFoundError('Resource not found in Teable');\n      }\n      throw new ExternalServiceError(`Teable API error: ${response.status}`, response.status);\n    }\n\n    return response.json();\n  } catch (error) {\n    if (error.name === 'AbortError') {\n      throw new TimeoutError('Teable API request timeout (>5s)');\n    }\n    if (error instanceof APIError) {\n      throw error;\n    }\n    throw new ExternalServiceError(`Failed to fetch from Teable: ${error.message}`);\n  }\n}\n\nasync function getAllStates() {\n  const cacheKey = 'all-states';\n  const cached = cache.get(cacheKey);\n  \n  if (cached) {\n    return { data: cached, fromCache: true };\n  }\n\n  const response = await fetchFromTeable(TABLE_IDS.states);\n  const states = response.records.map(record => ({\n    code: record.fields.code,\n    name: record.fields.name,\n    abbreviation: record.fields.abbreviation,\n    isLegal: record.fields.isLegal,\n    maxWattage: record.fields.maxWattage,\n    keyLaw: record.fields.keyLaw,\n    lastUpdated: record.fields.lastUpdated,\n  }));\n\n  cache.set(cacheKey, states);\n  return { data: states, fromCache: false };\n}\n\nasync function getStateByCode(code) {\n  const cacheKey = `state-${code}`;\n  const cached = cache.get(cacheKey);\n  \n  if (cached) {\n    return { data: cached, fromCache: true };\n  }\n\n  // Fetch state\n  const statesResponse = await fetchFromTeable(TABLE_IDS.states, `?filter=code=\"${code}\"`);\n  \n  if (!statesResponse.records || statesResponse.records.length === 0) {\n    return { data: null, fromCache: false };\n  }\n\n  const stateRecord = statesResponse.records[0];\n  const state = {\n    code: stateRecord.fields.code,\n    name: stateRecord.fields.name,\n    abbreviation: stateRecord.fields.abbreviation,\n    isLegal: stateRecord.fields.isLegal,\n    maxWattage: stateRecord.fields.maxWattage,\n    keyLaw: stateRecord.fields.keyLaw,\n    lastUpdated: stateRecord.fields.lastUpdated,\n    details: {},\n    resources: [],\n  };\n\n  // Fetch details\n  const detailsResponse = await fetchFromTeable(TABLE_IDS.details, `?filter=stateCode=\"${code}\"`);\n  if (detailsResponse.records) {\n    detailsResponse.records.forEach(record => {\n      const category = record.fields.category;\n      state.details[category] = {\n        required: record.fields.required,\n        description: record.fields.description,\n      };\n    });\n  }\n\n  // Fetch resources\n  const resourcesResponse = await fetchFromTeable(TABLE_IDS.resources, `?filter=stateCode=\"${code}\"`);\n  if (resourcesResponse.records) {\n    state.resources = resourcesResponse.records.map(record => ({\n      title: record.fields.title,\n      url: record.fields.url,\n      resourceType: record.fields.resourceType,\n    }));\n  }\n\n  cache.set(cacheKey, state);\n  return { data: state, fromCache: false };\n}\n\nfunction getCacheHeaders(fromCache = false) {\n  if (fromCache) {\n    return {\n      'Cache-Control': `public, max-age=${CACHE_TTL_SECONDS}`,\n      'X-Cache': 'HIT',\n    };\n  }\n  return {\n    'Cache-Control': `public, max-age=${CACHE_TTL_SECONDS}`,\n    'X-Cache': 'MISS',\n  };\n}\n\nasync function handleRequest(request) {\n  const url = new URL(request.url);\n  const path = url.pathname;\n\n  // CORS headers\n  const corsHeaders = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n  };\n\n  // Handle CORS preflight\n  if (request.method === 'OPTIONS') {\n    return new Response(null, { headers: corsHeaders });\n  }\n\n  try {\n    // GET /api/states - Get all states\n    if (path === '/api/states' && request.method === 'GET') {\n      const result = await getAllStates();\n      const cacheHeaders = getCacheHeaders(result.fromCache);\n      return new Response(JSON.stringify({ states: result.data }), {\n        headers: { 'Content-Type': 'application/json', ...corsHeaders, ...cacheHeaders },\n      });\n    }\n\n    // GET /api/states/:code - Get single state\n    if (path.match(/^\\/api\\/states\\/[a-z]{2}$/) && request.method === 'GET') {\n      const code = path.split('/')[3];\n      const result = await getStateByCode(code);\n      \n      if (!result.data) {\n        return new Response(JSON.stringify({ error: 'State not found' }), {\n          status: 404,\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      }\n\n      const cacheHeaders = getCacheHeaders(result.fromCache);\n      return new Response(JSON.stringify({ state: result.data }), {\n        headers: { 'Content-Type': 'application/json', ...corsHeaders, ...cacheHeaders },\n      });\n    }\n\n    // GET /api/health - Health check\n    if (path === '/api/health' && request.method === 'GET') {\n      const stats = cache.getStats();\n      return new Response(JSON.stringify({ \n        status: 'ok',\n        timestamp: new Date().toISOString(),\n        cache: stats,\n      }), {\n        headers: { 'Content-Type': 'application/json', ...corsHeaders },\n      });\n    }\n\n    // POST /api/cache-invalidate - Invalidate cache (internal, requires authentication)\n    if (path === '/api/cache-invalidate' && request.method === 'POST') {\n      // Verify authentication token\n      const authHeader = request.headers.get('Authorization');\n      const token = authHeader ? authHeader.replace('Bearer ', '') : null;\n      \n      if (!token || token !== CACHE_INVALIDATE_TOKEN) {\n        return new Response(JSON.stringify({ error: 'Unauthorized' }), {\n          status: 401,\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      }\n\n      const body = await request.json();\n      const pattern = body.pattern || null;\n      cache.invalidate(pattern);\n      \n      return new Response(JSON.stringify({ \n        status: 'cache invalidated',\n        pattern: pattern,\n        timestamp: new Date().toISOString(),\n      }), {\n        headers: { 'Content-Type': 'application/json', ...corsHeaders },\n      });\n    }\n\n    // POST /api/analytics/events - Record analytics events\n    if (path === '/api/analytics/events' && request.method === 'POST') {\n      try {\n        const body = await request.json();\n        const { sessionId, events } = body;\n\n        if (!sessionId || !Array.isArray(events)) {\n          return new Response(JSON.stringify({ error: 'Invalid request body' }), {\n            status: 400,\n            headers: { 'Content-Type': 'application/json', ...corsHeaders },\n          });\n        }\n\n        analytics.recordEvents(sessionId, events);\n\n        return new Response(JSON.stringify({ \n          status: 'events recorded',\n          count: events.length,\n          timestamp: new Date().toISOString(),\n        }), {\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      } catch (error) {\n        return new Response(JSON.stringify({ error: 'Failed to record events' }), {\n          status: 400,\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      }\n    }\n\n    // POST /api/feedback - Submit user feedback\n    if (path === '/api/feedback' && request.method === 'POST') {\n      try {\n        const body = await request.json();\n        \n        analytics.recordFeedback({\n          type: body.type || 'general',\n          rating: body.rating || null,\n          message: body.message || '',\n          stateCode: body.stateCode || null,\n          email: body.email || null,\n          timestamp: body.timestamp || new Date().toISOString(),\n          userAgent: body.userAgent || '',\n          url: body.url || '',\n        });\n\n        return new Response(JSON.stringify({ \n          status: 'feedback recorded',\n          timestamp: new Date().toISOString(),\n        }), {\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      } catch (error) {\n        return new Response(JSON.stringify({ error: 'Failed to record feedback' }), {\n          status: 400,\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      }\n    }\n\n    // GET /api/analytics/summary - Get analytics summary (internal)\n    if (path === '/api/analytics/summary' && request.method === 'GET') {\n      const authHeader = request.headers.get('Authorization');\n      const token = authHeader ? authHeader.replace('Bearer ', '') : null;\n      \n      if (!token || token !== CACHE_INVALIDATE_TOKEN) {\n        return new Response(JSON.stringify({ error: 'Unauthorized' }), {\n          status: 401,\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      }\n\n      const windowMs = parseInt(url.searchParams.get('window') || '86400000'); // Default 24 hours\n      const summary = analytics.getAnalyticsSummary(windowMs);\n\n      return new Response(JSON.stringify(summary), {\n        headers: { 'Content-Type': 'application/json', ...corsHeaders },\n      });\n    }\n\n    // GET /api/analytics/engagement - Get engagement metrics (internal)\n    if (path === '/api/analytics/engagement' && request.method === 'GET') {\n      const authHeader = request.headers.get('Authorization');\n      const token = authHeader ? authHeader.replace('Bearer ', '') : null;\n      \n      if (!token || token !== CACHE_INVALIDATE_TOKEN) {\n        return new Response(JSON.stringify({ error: 'Unauthorized' }), {\n          status: 401,\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      }\n\n      const windowMs = parseInt(url.searchParams.get('window') || '86400000');\n      const metrics = analytics.getEngagementMetrics(windowMs);\n\n      return new Response(JSON.stringify(metrics), {\n        headers: { 'Content-Type': 'application/json', ...corsHeaders },\n      });\n    }\n\n    // GET /api/analytics/feedback - Get feedback summary (internal)\n    if (path === '/api/analytics/feedback' && request.method === 'GET') {\n      const authHeader = request.headers.get('Authorization');\n      const token = authHeader ? authHeader.replace('Bearer ', '') : null;\n      \n      if (!token || token !== CACHE_INVALIDATE_TOKEN) {\n        return new Response(JSON.stringify({ error: 'Unauthorized' }), {\n          status: 401,\n          headers: { 'Content-Type': 'application/json', ...corsHeaders },\n        });\n      }\n\n      const windowMs = parseInt(url.searchParams.get('window') || '86400000');\n      const summary = analytics.getFeedbackSummary(windowMs);\n\n      return new Response(JSON.stringify(summary), {\n        headers: { 'Content-Type': 'application/json', ...corsHeaders },\n      });\n    }\n\n    // 404\n    return new Response(JSON.stringify({ error: 'Not found' }), {\n      status: 404,\n      headers: { 'Content-Type': 'application/json', ...corsHeaders },\n    });\n  } catch (error) {\n    console.error('API error:', error);\n    \n    const errorResponse = formatErrorResponse(error);\n    const statusCode = errorResponse.statusCode;\n    \n    return new Response(JSON.stringify(errorResponse.error), {\n      status: statusCode,\n      headers: { 'Content-Type': 'application/json', ...corsHeaders },\n    });\n  }\n}\n\nexport default {\n  fetch: handleRequest,\n};\n"],
  "mappings": "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",
  "names": []
}
